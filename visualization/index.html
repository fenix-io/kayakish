<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <link rel="icon" href="logo.svg" type="image/svg">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kayakish - Kayak Hull Analyzer</title>
    <link rel="stylesheet" href="styles.css">
    
    <!-- Three.js Import Map for ES Modules -->
    <script type="importmap">
    {
      "imports": {
        "three": "https://cdn.jsdelivr.net/npm/three@0.160.0/build/three.module.js",
        "three/addons/": "https://cdn.jsdelivr.net/npm/three@0.160.0/examples/jsm/"
      }
    }
    </script>
</head>
<body>
    <header class="app-header">
        <div class="header-content">
            <img src="logo.svg" alt="Kayakish Logo" class="app-logo">
            <div class="header-text">
                <h1 class="app-title">Kayakish</h1>
                <p class="app-subtitle">Kayak and small boats calculation tool</p>
            </div>
        </div>
    </header>
    <div class="container">
        <!-- Kayak List (Top Left) -->
        <div class="kayak-list">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                <h2 style="margin-bottom: 0;">Available Kayaks</h2>
                <button class="add-kayak-button" onclick="openCreateModal()">+ New</button>
            </div>
            <div id="kayakListContainer">
                <p class="loading">Loading kayaks...</p>
            </div>
            <!-- Notification Area -->
            <div id="notification" class="notification">
                <span id="notificationMessage"></span>
                <button class="notification-close" onclick="closeNotification()">&times;</button>
            </div>
        </div>

        <!-- Kayak Summary (Bottom Left) -->
        <div class="kayak-summary">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                <h2 id="summaryTitle" style="margin-bottom: 0;">Summary</h2>
                <button id="toggleDetailsBtn" class="toggle-details-button" style="display: none;" onclick="toggleDetailsView()">+ Details</button>
            </div>
            <div id="kayakSummaryContainer">
                <p>Select a kayak to view summary</p>
            </div>
        </div>

        <!-- Canvas Visualization (Right 4 blocks) -->
        <div class="canvas-container">
            <h2>Hull Analysis</h2>
            
            <!-- Tabs -->
            <div class="tabs">
                <button class="tab-button active" onclick="switchTab('visualization')">Visualization</button>
                <button class="tab-button" onclick="switchTab('stability')">Stability</button>
                <button class="tab-button" onclick="switchTab('resistance')">Resistance</button>
                <button class="tab-button" onclick="switchTab('profiles')">Profiles</button>
            </div>
            
            <!-- Tab Content: Visualization -->
            <div id="visualization-tab" class="tab-content active">
                <div class="controls">
                    <label for="viewSelect">Camera:</label>
                    <select id="viewSelect">
                        <option value="iso">Isometric View</option>
                        <option value="side">Side View</option>
                        <option value="top">Top View</option>
                        <option value="front">Front View</option>
                    </select>
                    
                    <div class="control-divider"></div>
                    
                    <label for="qualitySelect">Quality:</label>
                    <select id="qualitySelect">
                        <option value="low">Low</option>
                        <option value="medium" selected>Medium</option>
                        <option value="high">High</option>
                    </select>
                    
                    <div class="control-divider"></div>
                    
                    <label style="display: flex; align-items: center; cursor: pointer; margin-left: 10px;">
                        <input type="checkbox" id="showWireframe" style="margin-right: 5px;">
                        <span>Wireframe</span>
                    </label>
                    
                    <label style="display: flex; align-items: center; cursor: pointer; margin-left: 10px;">
                        <input type="checkbox" id="showWaterline" checked style="margin-right: 5px;">
                        <span>Waterline</span>
                    </label>
                    
                    <label style="display: flex; align-items: center; cursor: pointer; margin-left: 10px;">
                        <input type="checkbox" id="showCurves" style="margin-right: 5px;">
                        <span>Curves</span>
                    </label>
                    
                    <label style="display: flex; align-items: center; cursor: pointer; margin-left: 10px;">
                        <input type="checkbox" id="showProfiles" style="margin-right: 5px;">
                        <span>Profiles</span>
                    </label>
                    
                    <label style="display: flex; align-items: center; cursor: pointer; margin-left: 10px;">
                        <input type="checkbox" id="showMeasurements" style="margin-right: 5px;">
                        <span>Measurements</span>
                    </label>
                    
                    <div class="control-divider"></div>
                    
                    <label style="display: flex; align-items: center; cursor: pointer; margin-left: 10px;">
                        <input type="checkbox" id="showShadows" checked style="margin-right: 5px;">
                        <span>Shadows</span>
                    </label>
                    
                    <label style="display: flex; align-items: center; cursor: pointer; margin-left: 10px;">
                        <input type="checkbox" id="showFPS" style="margin-right: 5px;">
                        <span>FPS Counter</span>
                    </label>
                    
                    <div id="fpsDisplay" style="margin-left: 10px; font-weight: bold; color: #00ff00; display: none;">FPS: 0</div>
                </div>
                <div class="legend">
                    <div class="legend-item">
                        <span class="legend-color" style="background-color: #1A3366;"></span>
                        <span>Hull (Above WL)</span>
                    </div>
                    <div class="legend-item">
                        <span class="legend-color" style="background-color: #66B3E6;"></span>
                        <span>Hull (Below WL)</span>
                    </div>
                    <div class="legend-item">
                        <span class="legend-color" style="background-color: #0000CC;"></span>
                        <span>Curves</span>
                    </div>
                    <div class="legend-item">
                        <span class="legend-color" style="background-color: #008000;"></span>
                        <span>Profiles</span>
                    </div>
                    <div class="legend-item">
                        <span class="legend-color" style="background-color: cyan;"></span>
                        <span>Waterline</span>
                    </div>
                    <div class="legend-item">
                        <span class="legend-color" style="background-color: #FF0000;"></span>
                        <span>Length</span>
                    </div>
                    <div class="legend-item">
                        <span class="legend-color" style="background-color: #00FF00;"></span>
                        <span>Beam</span>
                    </div>
                    <div class="legend-item">
                        <span class="legend-color" style="background-color: #0000FF;"></span>
                        <span>Depth</span>
                    </div>
                    <div class="legend-help">
                        <span>ðŸ’¡ Drag to rotate â€¢ Scroll to zoom â€¢ Right-drag to pan</span>
                    </div>
                </div>
                <div id="loadingOverlay" class="loading-overlay" style="display: none;">
                    <div class="loading-spinner"></div>
                    <div class="loading-text">Generating hull mesh...</div>
                </div>
                <canvas id="hullCanvas"></canvas>
            </div>
            
            <!-- Tab Content: Stability -->
            <div id="stability-tab" class="tab-content">
                <div class="stability-form-container">
                    <form id="stabilityForm" class="stability-form">
                        <div class="form-row">
                            <div class="form-group">
                                <label for="paddlerWeight">Paddler Weight (kg)</label>
                                <input type="number" id="paddlerWeight" step="0.1" placeholder="e.g., 80.0">
                            </div>
                            
                            <div class="form-group">
                                <label for="paddlerCgZ">Paddler CG Height (m)</label>
                                <input type="number" id="paddlerCgZ" step="0.01" value="0.25">
                            </div>
                        </div>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label for="hullWeight">Hull Weight (kg)</label>
                                <input type="number" id="hullWeight" step="0.1" placeholder="e.g., 25.0">
                            </div>
                            
                            <div class="form-group">
                                <label for="maxAngle">Max Angle (degrees)</label>
                                <input type="number" id="maxAngle" step="1" value="90">
                            </div>
                        </div>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label for="angleStep">Angle Step (degrees)</label>
                                <input type="number" id="angleStep" step="0.5" value="3">
                            </div>
                            
                            <div class="form-group">
                                <label style="display: flex; align-items: center; cursor: pointer; margin-top: 23px;">
                                    <input type="checkbox" id="breakOnVanishing" style="margin-right: 8px; cursor: pointer;">
                                    <span>Break on vanishing angle reached</span>
                                </label>
                            </div>
                        </div>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <button type="submit" class="btn-primary" style="width: 100%;">
                                    Analyze Stability
                                </button>
                            </div>
                        </div>
                    </form>
                </div>
                
                <div id="stabilityLoader" class="stability-loader">
                    <img src="https://i.gifer.com/ZZ5H.gif" alt="Loading..." />
                    <p>Analyzing stability...</p>
                </div>
                
                <div id="stabilityResults" class="stability-results">
                    <div class="stability-graphs">
                        <div class="graph-container">
                            <h3>Righting Arm (GZ) vs Heel Angle</h3>
                            <canvas id="gzCanvas"></canvas>
                        </div>
                        <div class="graph-container">
                            <h3>Righting Moment vs Heel Angle</h3>
                            <canvas id="momentCanvas"></canvas>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Tab Content: Resistance -->
            <div id="resistance-tab" class="tab-content">
                <div class="resistance-form-container">
                    <form id="resistanceForm" class="resistance-form">
                        <div class="form-row">
                            <div class="form-group">
                                <label for="minSpeed">Min Speed (m/s)</label>
                                <input type="number" id="minSpeed" step="0.1" value="0.5" min="0">
                            </div>
                            
                            <div class="form-group">
                                <label for="maxSpeed">Max Speed (m/s)</label>
                                <input type="number" id="maxSpeed" step="0.1" value="4.0" min="0.1">
                            </div>
                        </div>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label for="speedStep">Speed Step (m/s)</label>
                                <input type="number" id="speedStep" step="0.05" value="0.25" min="0.01">
                            </div>
                            
                            <div class="form-group">
                                <label for="waterType">Water Type</label>
                                <select id="waterType">
                                    <option value="fresh">Fresh Water</option>
                                    <option value="salt">Salt Water</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label for="roughnessAllowance">Surface Roughness</label>
                                <select id="roughnessAllowance">
                                    <option value="0.0002">Smooth (gelcoat, polished)</option>
                                    <option value="0.0004" selected>Standard (thermoformed plastic)</option>
                                    <option value="0.0006">Rough (weathered, composite)</option>
                                </select>
                            </div>
                            
                            <div class="form-group">
                                <label for="propulsionEfficiency">Paddle Efficiency</label>
                                <select id="propulsionEfficiency">
                                    <option value="0.50">Low (0.50 - beginner)</option>
                                    <option value="0.60" selected>Medium (0.60 - average)</option>
                                    <option value="0.70">High (0.70 - expert)</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <button type="submit" class="btn-primary" style="width: 100%;">
                                    Analyze Resistance
                                </button>
                            </div>
                        </div>
                    </form>
                </div>
                
                <div id="resistanceLoader" class="resistance-loader">
                    <img src="https://i.gifer.com/ZZ5H.gif" alt="Loading..." />
                    <p>Analyzing resistance...</p>
                </div>
                
                <div id="resistanceResults" class="resistance-results">
                    <div class="resistance-summary">
                        <h3>Hull Parameters</h3>
                        <div class="resistance-params">
                            <div class="param-item">
                                <span class="param-label">Waterline Length:</span>
                                <span id="paramWaterlineLength" class="param-value">-</span>
                            </div>
                            <div class="param-item">
                                <span class="param-label">Waterline Beam:</span>
                                <span id="paramWaterlineBeam" class="param-value">-</span>
                            </div>
                            <div class="param-item">
                                <span class="param-label">Wetted Surface:</span>
                                <span id="paramWettedSurface" class="param-value">-</span>
                            </div>
                            <div class="param-item">
                                <span class="param-label">Hull Speed:</span>
                                <span id="paramHullSpeed" class="param-value">-</span>
                            </div>
                            <div class="param-item">
                                <span class="param-label">Block Coefficient (Cb):</span>
                                <span id="paramBlockCoeff" class="param-value">-</span>
                            </div>
                            <div class="param-item">
                                <span class="param-label">Prismatic Coefficient (Cp):</span>
                                <span id="paramPrismaticCoeff" class="param-value">-</span>
                            </div>
                        </div>
                    </div>
                    <div class="resistance-graphs">
                        <div class="graph-container">
                            <h3>Total Resistance vs Speed</h3>
                            <canvas id="resistanceCanvas"></canvas>
                        </div>
                        <div class="graph-container">
                            <h3>Power Requirements vs Speed</h3>
                            <canvas id="powerCanvas"></canvas>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Tab Content: Profiles -->
            <div id="profiles-tab" class="tab-content">
                <div id="profilesEmpty" class="empty-state">
                    <p>Select a kayak and load details to view profiles</p>
                </div>
                
                <div id="profilesContent" class="profiles-content">
                    <div class="profile-selector">
                        <label for="stationSelect">Station (x position):</label>
                        <button class="nav-btn" onclick="changeProfile(-10)" title="Previous 10 profiles">&lt;&lt;</button>
                        <button class="nav-btn" onclick="changeProfile(-1)" title="Previous profile">&lt;</button>
                        <select id="stationSelect" onchange="selectStation()">
                            <option value="">Select a station...</option>
                        </select>
                        <button class="nav-btn" onclick="changeProfile(1)" title="Next profile">&gt;</button>
                        <button class="nav-btn" onclick="changeProfile(10)" title="Next 10 profiles">&gt;&gt;</button>
                        <span id="stationInfo" class="station-info"></span>
                    </div>
                    
                    <div class="profile-views">
                        <div class="profile-view-container">
                            <h3>Profile Cross-Section (Y-Z Plane)</h3>
                            <canvas id="profileCanvas"></canvas>
                        </div>
                        
                        <div class="hull-side-view-container">
                            <h3>Hull Side View (Station Position)</h3>
                            <canvas id="hullSideCanvas"></canvas>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Create Kayak Modal -->
    <div id="createModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Create New Kayak</h2>
                <span class="close" onclick="closeCreateModal()">&times;</span>
            </div>
            <div class="modal-body">
                <form id="createHullForm">
                    <div class="form-group">
                        <label for="hullName">Name *</label>
                        <input type="text" id="hullName" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="hullDescription">Description</label>
                        <input type="text" id="hullDescription">
                    </div>
                    
                    <div class="form-group">
                        <label for="targetWaterline">Target Waterline (m)</label>
                        <input type="number" id="targetWaterline" step="0.01">
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="targetPayload">Target Payload (kg)</label>
                            <input type="number" id="targetPayload" step="0.1">
                        </div>
                        
                        <div class="form-group">
                            <label for="targetWeight">Target Weight (kg)</label>
                            <input type="number" id="targetWeight" step="0.1">
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="curvesData">Curves Data *</label>
                        <textarea id="curvesData" rows="10" placeholder="Enter curves in format:
curve: curve_name
x, y, z
x, y, z
curve: another_curve_name
x, y, z
..."></textarea>
                        <small>Format: Start each curve with "curve: name", then list points as "x, y, z" (one per line)</small>
                    </div>
                    
                    <div class="form-actions">
                        <button type="button" class="btn-secondary" onclick="closeCreateModal()">Cancel</button>
                        <button type="submit" class="btn-primary">Create Kayak</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Edit Kayak Modal -->
    <div id="editModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Edit Kayak</h2>
                <span class="close" onclick="closeEditModal()">&times;</span>
            </div>
            <div class="modal-body">
                <form id="editHullForm">
                    <div class="form-group">
                        <label for="editHullName">Name *</label>
                        <input type="text" id="editHullName" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="editHullDescription">Description</label>
                        <input type="text" id="editHullDescription">
                    </div>
                    
                    <div class="form-group">
                        <label for="editTargetWaterline">Target Waterline (m)</label>
                        <input type="number" id="editTargetWaterline" step="0.01">
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="editTargetPayload">Target Payload (kg)</label>
                            <input type="number" id="editTargetPayload" step="0.1">
                        </div>
                        
                        <div class="form-group">
                            <label for="editTargetWeight">Target Weight (kg)</label>
                            <input type="number" id="editTargetWeight" step="0.1">
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="editCurvesData">Curves Data *</label>
                        <textarea id="editCurvesData" rows="10" placeholder="Enter curves in format:
curve: curve_name
x, y, z
x, y, z
curve: another_curve_name
x, y, z
..."></textarea>
                        <small>Format: Start each curve with "curve: name", then list points as "x, y, z" (one per line)</small>
                    </div>
                    
                    <div class="form-actions">
                        <button type="button" class="btn-secondary" onclick="closeEditModal()">Cancel</button>
                        <button type="submit" class="btn-primary">Update Kayak</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Delete Confirmation Modal -->
    <div id="deleteModal" class="modal">
        <div class="modal-content modal-small">
            <div class="modal-header modal-header-danger">
                <h2>Confirm Delete</h2>
                <span class="close" onclick="closeDeleteModal()">&times;</span>
            </div>
            <div class="modal-body">
                <p>Are you sure you want to delete the kayak <strong id="deleteKayakName"></strong>?</p>
                <p style="color: #d32f2f; font-size: 13px; margin-top: 10px;">This action cannot be undone.</p>
                
                <div class="form-actions" style="margin-top: 20px;">
                    <button type="button" class="btn-secondary" onclick="closeDeleteModal()">Cancel</button>
                    <button type="button" class="btn-danger" onclick="confirmDeleteKayak()">Delete</button>
                </div>
            </div>
        </div>
    </div>

    <script type="module" src="script.js"></script>
</body>
</html>
